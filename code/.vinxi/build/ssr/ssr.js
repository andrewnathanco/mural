import{ssrElement as g,escape as m,mergeProps as x,ssr as d,getRequestEvent as k,createComponent as h,NoHydration as v,ssrHydrationKey as b,ssrAttribute as j,renderToStream as M}from"solid-js/web";import{getRequestURL as E,getRequestWebStream as P,getRequestIP as F,setResponseHeader as y,setResponseStatus as w,appendResponseHeader as H,getResponseHeader as I,removeResponseHeader as N,getCookie as L,setCookie as O,eventHandler as D,sendRedirect as B,setHeader as U}from"h3";import{lazy as _,createComponent as W,sharedConfig as R}from"solid-js";import{provideRequestEvent as z}from"solid-js/web/storage";function J(e){let n;const t=E(e),s={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...s,body:e.node.req.body}):new Request(t,{...s,get body(){return n||(n=P(e),n)}})}function K(e){return e.web??={request:J(e),url:E(e)},e.web.request}const q=Symbol("h3Event"),f=Symbol("fetchEvent"),Y={get(e,n){return n===f?e:e[n]??e[q][n]}};function G(e){const n=K(e);return new Proxy({request:n,clientAddress:F(e),locals:{},[q]:e},Y)}function Q(e){if(!e[f]){const n=G(e);e[f]=n}return e[f]}var V=" ";const X={style:e=>g("style",e.attrs,()=>m(e.children),!0),link:e=>g("link",e.attrs,void 0,!0),script:e=>e.attrs.src?g("script",x(()=>e.attrs,{get id(){return e.key}}),()=>d(V),!0):null};function C(e){let{tag:n,attrs:{key:t,...s}={key:void 0},children:r}=e;return X[n]({attrs:s,key:t,children:r})}var Z=["<script",">","<\/script>"],ee=["<script",' type="module"',"><\/script>"];const te=d("<!DOCTYPE html>");function ne(e){const n=k();return h(v,{get children(){return[te,h(e.document,{get assets(){return n.assets.map(t=>C(t))},get scripts(){return[d(Z,b(),`window.manifest = ${JSON.stringify(n.manifest)}`),d(ee,b(),j("src",m(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]}})]}})}function se(e){e.forEach(n=>{if(!n.attrs.href)return;let t=document.head.querySelector(`link[href="${n.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",n.attrs.href),document.head.appendChild(t))})}function re(e,n,t,s="default"){return _(async()=>{{const o=(await e.import())[s],i=(await n.inputs?.[e.src].assets()).filter(l=>l.tag==="style"||l.attrs.rel==="stylesheet");return typeof window<"u"&&se(i),{default:l=>[...i.map(u=>C(u)),W(o,l)]}}})}const T=[{type:"page",$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("./_...404_.js"),import:()=>import("./_...404_.js")},path:"/*404",filePath:"/Users/andrew/Documents/Dev/Projects/andrewnathanco/github/proj-ancgames/mural/code/src/routes/[...404].tsx"},{type:"page",$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("./index.js"),import:()=>import("./index.js")},path:"/",filePath:"/Users/andrew/Documents/Dev/Projects/andrewnathanco/github/proj-ancgames/mural/code/src/routes/index.tsx"},{type:"page",$component:{src:"src/routes/share.tsx?pick=default&pick=$css",build:()=>import("./share.js"),import:()=>import("./share.js")},path:"/share",filePath:"/Users/andrew/Documents/Dev/Projects/andrewnathanco/github/proj-ancgames/mural/code/src/routes/share.tsx"}],ae=ce(T.filter(e=>e.type==="page")),oe=le(T.filter(e=>e.type==="api"));function ie(e,n){const t=e.replace("/","").split("/").filter(Boolean);e:for(const s of oe){const r=s.matchSegments;if(t.length<r.length||!s.wildcard&&t.length>r.length)continue;for(let i=0;i<r.length;i++){const c=r[i];if(c&&t[i]!==c)continue e}const o=s[`$${n}`];if(o==="skip"||o===void 0)return;const a={};for(const{type:i,name:c,index:l}of s.params)i===":"?a[c]=t[l]:a[c]=t.slice(l).join("/");return{handler:o,params:a}}}function ce(e){function n(t,s,r,o){const a=Object.values(t).find(i=>r.startsWith(i.id+"/"));return a?(n(a.children||(a.children=[]),s,r.slice(a.id.length)),t):(t.push({...s,id:r,path:r.replace(/\/\([^)/]+\)/g,"")}),t)}return e.sort((t,s)=>t.path.length-s.path.length).reduce((t,s)=>n(t,s,s.path,s.path),[])}function le(e){return e.flatMap(n=>A(n.path).map(s=>({...n,path:s}))).map(ue).sort((n,t)=>t.score-n.score)}function A(e){let n=/(\/?\:[^\/]+)\?/.exec(e);if(!n)return[e];let t=e.slice(0,n.index),s=e.slice(n.index+n[0].length);const r=[t,t+=n[1]];for(;n=/^(\/\:[^\/]+)\?/.exec(s);)r.push(t+=n[1]),s=s.slice(n[0].length);return A(s).reduce((o,a)=>[...o,...r.map(i=>i+a)],[])}function ue(e){const n=e.path.split("/").filter(Boolean),t=[],s=[];let r=0,o=!1;for(const[a,i]of n.entries())if(i[0]===":"){const c=i.slice(1);r+=3,t.push({type:":",name:c,index:a}),s.push(null)}else i[0]==="*"?(r-=1,t.push({type:"*",name:i.slice(1),index:a}),o=!0):(r+=4,i.match(/^\(.+\)$/)||s.push(i));return{...e,score:r,params:t,matchSegments:s,wildcard:o}}function pe(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,metadata:{...t.$$route?t.$$route.require().route.metadata:{},filesystem:!0},component:re(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return ae.map(e)}function de(e){const n=L(e,"flash");if(!n)return;let t=JSON.parse(n);if(!t||!t.result)return[];const s=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])];return O(e,"flash","",{maxAge:0}),{url:t.url,result:t.error?new Error(t.result):t.result,input:s}}async function me(e){const n=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,y(e,"Content-Type","text/html"),Object.assign(e,{manifest:await n.json(),assets:[...await n.inputs[n.handler].assets()],initialSubmission:de(e),routes:pe(),components:{status:s=>(w(e,s.code,s.text),()=>w(e,200)),header:s=>(s.append?H(e,s.name,s.value):y(e,s.name,s.value),()=>{const r=I(e,s.name);if(r&&typeof r=="string"){const o=r.split(", "),a=o.indexOf(s.value);a!==-1&&o.splice(a,1),o.length?y(e,s.name,o.join(", ")):N(e,s.name)}})},$islands:new Set})}function fe(e,n={}){return D({onRequest:n.onRequest,onBeforeResponse:n.onBeforeResponse,handler:t=>{const s=Q(t);return z(s,async()=>{const r=ie(new URL(s.request.url).pathname,s.request.method);if(r){const p=(await r.handler.import())[s.request.method];return s.params=r.params,R.context={event:s},await p(s)}const o=await me(s);let a={...n};if(a.onCompleteAll){const u=a.onCompleteAll;a.onCompleteAll=p=>{$(o)(p),u(p)}}else a.onCompleteAll=$(o);if(a.onCompleteShell){const u=a.onCompleteShell;a.onCompleteShell=p=>{S(o,t)(),u(p)}}else a.onCompleteShell=S(o,t);const i=M(()=>(R.context.event=o,e(o)),a);if(o.response&&o.response.headers.get("Location"))return B(s,o.response.headers.get("Location"));const{writable:c,readable:l}=new TransformStream;return i.pipeTo(c),l})}})}function S(e,n){return()=>{e.response&&e.response.headers.get("Location")&&(w(n,302),U(n,"Location",e.response.headers.get("Location")))}}function $(e){return({write:n})=>{const t=e.response&&e.response.headers.get("Location");t&&n(`<script>window.location="${t}"<\/script>`)}}function he(e,n){return fe(e,{...n,createPageEvent:ge})}async function ge(e){const n=globalThis.MANIFEST.client;return Object.assign(e,{manifest:await n.json(),assets:[...await n.inputs[n.handler].assets()],routes:[],$islands:new Set})}var ye=['<head><script defer data-domain="ancgames.com" src="https://plausible.io/js/script.js"><\/script><meta charset="utf-8"><link rel="icon" href="/favicon.ico">',"</head>"],be=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const ve=he(()=>h(ne,{document:({assets:e,children:n,scripts:t})=>d(be,b(),h(v,{get children(){return d(ye,m(e))}}),m(n),m(t))}));export{ve as default};
